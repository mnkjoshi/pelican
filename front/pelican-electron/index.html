<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https: http:; img-src 'self' data: https:; frame-src 'self' https://calendar.google.com https://*.google.com;">
    <title>Pelican Command Center</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <!-- Custom Title Bar -->
    <div class="title-bar">
        <div class="title-info">
            <span class="app-title">Pelican</span>
            <span class="app-version">v1.0.0</span>
        </div>
        <div class="window-controls">
            <button class="window-btn minimize-btn" onclick="window.pelicanAPI.windowControl('minimize')">
                <i data-feather="minus"></i>
            </button>
            <button class="window-btn maximize-btn" onclick="window.pelicanAPI.windowControl('maximize')">
                <i data-feather="maximize-2"></i>
            </button>
            <button class="window-btn close-btn" onclick="window.pelicanAPI.windowControl('close')">
                <i data-feather="x"></i>
            </button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <div class="dashboard-grid">
            <!-- Canvas LMS Widget -->
            <div class="widget canvas-widget" id="canvas-widget">
                <div class="widget-header">
                    <h3>Canvas Assignments</h3>
                    <div class="widget-header-actions">
                        <button class="expand-btn" onclick="openGradesModal()" title="View Grades">
                            <i data-feather="bar-chart-2"></i>
                        </button>
                        <div class="widget-status" id="canvas-status"></div>
                    </div>
                </div>
                <div class="widget-content" id="canvas-content">
                    <div class="loading">Loading assignments...</div>
                </div>
            </div>

            <!-- Google Calendar Widget -->
            <div class="widget calendar-widget" id="calendar-widget">
                <div class="widget-header">
                    <h3>Upcoming Events</h3>
                    <button class="expand-btn" onclick="openCalendarModal()">
                        <i data-feather="calendar"></i>
                    </button>
                </div>
                <div class="widget-content" id="calendar-content">
                    <div class="loading">Loading events...</div>
                </div>
            </div>

            <!-- Service Status Widget -->
            <div class="widget status-widget" id="status-widget">
                <div class="widget-header">
                    <h3>Service Status</h3>
                    <button class="refresh-btn" onclick="refreshServices()">
                        <i data-feather="refresh-cw"></i>
                    </button>
                </div>
                <div class="widget-content" id="status-content">
                    <div class="loading">Checking services...</div>
                </div>
            </div>

            <!-- App Usage Widget -->
            <div class="widget usage-widget" id="usage-widget">
                <div class="widget-header">
                    <h3>App Usage (24h)</h3>
                    <button class="refresh-btn" onclick="refreshAppUsage()">
                        <i data-feather="refresh-cw"></i>
                    </button>
                </div>
                <div class="widget-content" id="usage-content">
                    <div class="loading">Loading usage data...</div>
                </div>
            </div>

            <!-- Analytics Dashboard Widget -->
            <div class="widget socials-widget" id="socials-widget">
                <div class="widget-header">
                    <h3>Analytics</h3>
                </div>
                <div class="widget-content" id="socials-content">
                    <div class="loading">Loading metrics...</div>
                </div>
            </div>

            <!-- Console & Metrics Widget -->
            <div class="widget console-widget" id="console-widget">
                <div class="widget-header">
                    <h3>System Console</h3>
                    <div class="console-controls">
                        <button class="console-btn" onclick="clearConsole()">Clear</button>
                    </div>
                </div>
                <div class="widget-content console-content" id="console-content">
                    <div class="console-output" id="console-output">
                        <div class="console-line">Pelican Command Center initialized...</div>
                        <div class="console-line">System monitoring active</div>
                    </div>
                </div>
            </div>

            <!-- Music Player Widget -->
            <div class="widget music-widget" id="music-widget">
                <div class="widget-header">
                    <h3>Music Player</h3>
                    <div class="music-controls-header">
                        <button class="console-btn" onclick="selectMusicFolder()">
                            <i data-feather="folder"></i> Folder
                        </button>
                        <button class="console-btn" id="shuffle-btn" onclick="toggleShuffle()">
                            <i data-feather="shuffle"></i>
                        </button>
                        <button class="console-btn autoplay-active" id="autoplay-btn" onclick="toggleAutoplay()">
                            <i data-feather="repeat"></i>
                        </button>
                        <button class="console-btn" id="upload-btn" onclick="openUploadModal()">
                            <i data-feather="upload"></i>
                        </button>
                        <div class="volume-control-header">
                            <i data-feather="volume-2" class="volume-icon-header" id="volume-icon-header"></i>
                            <input type="range" class="volume-bar-header" id="volume-bar" min="0" max="100" value="50">
                            <span class="volume-display-header" id="volume-display">50%</span>
                        </div>
                    </div>
                </div>
                <div class="widget-content music-content" id="music-content">
                    <!-- Current Track Info -->
                    <div class="current-track">
                        <div class="track-info">
                            <div class="track-title" id="current-track-title">No track selected</div>
                            <div class="track-artist" id="current-track-artist">Select a music folder to begin</div>
                        </div>
                        <div class="track-time">
                            <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="progress-container">
                        <input type="range" class="progress-bar" id="progress-bar" min="0" max="100" value="0">
                    </div>
                    
                    <!-- Playback Controls -->
                    <div class="playback-controls">
                        <button class="control-btn" onclick="previousTrack()">
                            <i data-feather="skip-back"></i>
                        </button>
                        <button class="control-btn play-pause-btn" id="play-pause-btn" onclick="togglePlayPause()">
                            <i data-feather="play" id="play-pause-icon"></i>
                        </button>
                        <button class="control-btn" onclick="nextTrack()">
                            <i data-feather="skip-forward"></i>
                        </button>
                    </div>
                    
                    <!-- Playlist -->
                    <div class="playlist-container">
                        <div class="playlist-header">Playlist</div>
                        <div class="playlist" id="playlist">
                            <div class="no-data">No music files loaded</div>
                        </div>
                    </div>
                </div>
                
                <!-- Hidden audio element -->
                <audio id="audio-player" preload="metadata"></audio>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="modal-overlay" id="calendar-modal" onclick="closeCalendarModal()">
        <div class="modal-content calendar-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Upcoming Events</h2>
                <button class="close-modal-btn" onclick="closeCalendarModal()">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="loading">Loading events...</div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="upload-modal" onclick="closeUploadModal()">
        <div class="modal-content upload-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Add Music</h2>
                <button class="close-modal-btn" onclick="closeUploadModal()">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-form">
                    <div class="upload-method-tabs">
                        <button class="tab-btn active" id="url-tab" onclick="switchUploadMethod('url')">YouTube URL</button>
                        <button class="tab-btn" id="file-tab" onclick="switchUploadMethod('file')">Upload File</button>
                    </div>
                    
                    <div class="upload-method" id="url-method">
                        <label for="music-link-input">Enter YouTube URL:</label>
                        <input type="text" id="music-link-input" class="link-input" placeholder="https://youtu.be/dQw4w9WgXcQ or https://youtube.com/watch?v=..." />
                        <div class="upload-tips">
                            <small>⚠️ YouTube downloads often fail due to restrictions. Try the file upload option instead.</small>
                        </div>
                        <div class="upload-actions">
                            <button class="upload-submit-btn" onclick="processUploadLink()">
                                <i data-feather="download"></i>
                                Try Download
                            </button>
                            <button class="upload-cancel-btn" onclick="closeUploadModal()">
                                <i data-feather="x"></i>
                                Cancel
                            </button>
                        </div>
                    </div>
                    
                    <div class="upload-method hidden" id="file-method">
                        <label for="file-input">Select audio file:</label>
                        <input type="file" id="file-input" accept="audio/*" class="file-input" />
                        <div class="upload-tips">
                            <small>Supported formats: MP3, WAV, FLAC, M4A, AAC, OGG</small>
                        </div>
                        <div class="upload-actions">
                            <button class="upload-submit-btn" onclick="processFileUpload()">
                                <i data-feather="plus"></i>
                                Add File
                            </button>
                            <button class="upload-cancel-btn" onclick="closeUploadModal()">
                                <i data-feather="x"></i>
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Grades Modal -->
    <div class="modal-overlay" id="grades-modal" onclick="closeGradesModal()">
        <div class="modal-content grades-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>Canvas Grades</h2>
                <button class="close-modal-btn" onclick="closeGradesModal()">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="grades-container" id="grades-container">
                    <div class="loading">Loading grades...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="utils.js"></script>
    <script src="renderer.js"></script>
    <script>
        // Initialize Feather icons after DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof feather !== 'undefined') {
                feather.replace();
            }
        });
    </script>
</body>
</html>